<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">
	<select id="getListCount" resultType="_int">
		select count(*)
		from board
		where status = 'Y'
	</select>
	
	<select id="selectBoardList" resultMap="boardResultSet">
		select board_no, title, content, writer as empno, ename as writer, count, create_date, update_date, is_notice, board.status
		from board
			join emp on(writer = empno)
		where board.status = 'Y'
		order by board_no desc
	</select>
	
	<resultMap type="board.model.vo.Board" id="boardResultSet">
		<id column="board_no" property="boardNo"/>
		<id column="title" property="title"/>
		<id column="content" property="content"/>
		<id column="empno" property="empNo"/>
		<id column="writer" property="writer"/>
		<id column="count" property="count"/>
		<id column="create_date" property="createDate"/>
		<id column="update_date" property="updateDate"/>
		<id column="is_notice" property="isNotice"/>
		<id column="status" property="status"/>
	</resultMap>
	
	<select id="getSearchListCount" resultType="_int">
		select count(*) 
		from board
			join emp on(writer = empno)
		where board.status = 'Y'
		<if test="condition =='writer'">
			and ename=#{value}
		</if>
		<if test="condition == 'content' or condition == 'title'">
			and ${condition} like '%' || #{value} || '%'
		</if>		
		<if test="condition != 'writer' and condition != 'content' and condition != 'title'">
			and (ename = #{value} or title like '%' || #{value} || '%' or content like '%' || #{value} || '%')			
		</if>
	</select>
	
	<select id="selectSearchList" resultMap="boardResultSet">
		select board_no, title, content, writer as empno, ename as writer, count, create_date, update_date, is_notice, board.status
		from board
			join emp on(writer = empno)
		where board.status = 'Y'
		<choose>
			<when test="condition == 'writer'">
				and ename= #{value}
			</when>
			<when test="condition == 'title' or condition =='content'">
				and ${condition} like '%' || #{value} || '%'
			</when>
			<otherwise>
				and(ename = #{value} or title like '%' || #{value} || '%' or content like '%' || #{value} || '%')
			</otherwise>
		</choose>
		order by board_no desc
	</select>
	
	<select id="selectBoard" resultMap="boardResultSet">
		select board_no, title, content, writer as empno, ename as writer, count, create_date, update_date, is_notice, board.status
			from board
				join emp on(writer = empno)
			where board.status = 'Y'
				and board_no = #{bId}
	</select>
	<select id="updateCount" >
		update board
		set count = count + 1
		where board_no = #{bId}
	</select>
	<update id="updateBoard">
		update board
		set title = #{title},
		    content = #{content}, update_date=sysdate, is_notice=#{isNotice}
		 where board_no= #{boardNo}
	</update>
	
	<insert id="insertBoard">
		insert into board
		values(seq_board.nextval, #{title}, #{content}, #{empNo}, default, default, default, #(isNotice), default)
	</insert>
	<update id="deleteBoard">
		update board
		set status = 'N'
		where board_no = #{boardNo};
	
	</update>
</mapper>